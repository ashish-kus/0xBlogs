<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Understanding Linux Filesystem Inode Tables | 0xBlogs</title>
<meta name="keywords" content="blog, linux, filesystems, inode">
<meta name="description" content="Introduction
The inode table is one of the most fundamental data structures in Linux filesystems, yet it remains mysterious to many users. An inode, short for index node, is essentially a data structure that stores all the metadata about a file or directory except for two crucial pieces of information: the filename itself and the actual file content. This separation of concerns is what makes Unix-like filesystems elegant and efficient.">
<meta name="author" content="Ashish Kushwaha">
<link rel="canonical" href="http://localhost:1313/posts/4/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css" integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn&#43;yY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/4/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="0xBlogs (Alt + H)">0xBlogs</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Understanding Linux Filesystem Inode Tables
    </h1>
    <div class="post-meta"><span title='2025-10-04 23:47:32 +0530 IST'>October 4, 2025</span>&nbsp;·&nbsp;<span>10 min</span>&nbsp;·&nbsp;<span>Ashish Kushwaha</span>&nbsp;|&nbsp;<span>
    <a href="https://github.com/ashish-kus/0xBlogs/tree/main/content//posts/4.md" rel="noopener noreferrer edit" target="_blank">Suggest Changes</a>
</span>

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="http://localhost:1313/images/4-cover.png" alt="0xBlogs default cover image">
        <figcaption>Cover image for 0xBlogs articles</figcaption>
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#what-an-inode-contains" aria-label="What an Inode Contains">What an Inode Contains</a></li>
                <li>
                    <a href="#how-inodes-work-in-practice" aria-label="How Inodes Work in Practice">How Inodes Work in Practice</a></li>
                <li>
                    <a href="#filesystem-operations-and-inodes" aria-label="Filesystem Operations and Inodes">Filesystem Operations and Inodes</a></li>
                <li>
                    <a href="#common-issues-and-considerations" aria-label="Common Issues and Considerations">Common Issues and Considerations</a></li>
                <li>
                    <a href="#performance-and-caching" aria-label="Performance and Caching">Performance and Caching</a></li>
                <li>
                    <a href="#advanced-techniques" aria-label="Advanced Techniques">Advanced Techniques</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>The inode table is one of the most fundamental data structures in Linux filesystems, yet it remains mysterious to many users. An inode, short for index node, is essentially a data structure that stores all the metadata about a file or directory except for two crucial pieces of information: the filename itself and the actual file content. This separation of concerns is what makes Unix-like filesystems elegant and efficient.</p>
<p>When you create a filesystem in Linux, a specific portion of the disk is reserved for the inode table. This table is essentially a fixed-size array of inodes, with each inode containing detailed metadata about a file. The number of inodes is determined when the filesystem is created, based on factors like the filesystem size and expected usage patterns. This means you can theoretically run out of inodes even if you have plenty of disk space left, which happens when you create too many small files.</p>
<p><strong>Practical Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check inode usage on your system</span>
</span></span><span class="line"><span class="cl">$ df -i
</span></span><span class="line"><span class="cl">Filesystem      Inodes  IUsed   IFree IUse% Mounted on
</span></span><span class="line"><span class="cl">/dev/sda1      <span class="m">6553600</span> <span class="m">450000</span> <span class="m">6103600</span>    7% /
</span></span><span class="line"><span class="cl">/dev/sdb1       <span class="m">524288</span>  <span class="m">45000</span>  <span class="m">479288</span>    9% /home
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># View inode numbers for files</span>
</span></span><span class="line"><span class="cl">$ ls -i /etc/passwd
</span></span><span class="line"><span class="cl"><span class="m">1234567</span> /etc/passwd
</span></span></code></pre></div><h2 id="what-an-inode-contains">What an Inode Contains<a hidden class="anchor" aria-hidden="true" href="#what-an-inode-contains">#</a></h2>
<p>Each inode is roughly 256 bytes in size and contains a wealth of information about a file. It stores the file type, whether it&rsquo;s a regular file, directory, symbolic link, or device file. The permission bits are stored here, including the read, write, and execute permissions for the owner, group, and others, along with special bits like setuid, setgid, and the sticky bit. Ownership information is tracked through user ID and group ID fields.</p>
<p>Timestamps are a critical part of the inode. Every file has an access time that records when it was last read, a modification time that shows when the content changed, and a change time that updates whenever the inode metadata itself changes. Modern filesystems like ext4 also support a birth time that records when the file was originally created. The inode also maintains a link count, which tracks how many directory entries point to this particular inode. When this count drops to zero, the filesystem knows it can safely reclaim the space.</p>
<p>The most complex part of an inode is how it stores references to the actual data blocks on disk. Traditional ext filesystems use a clever hierarchical scheme with twelve direct pointers that point straight to data blocks, perfect for small files. For larger files, there&rsquo;s an indirect pointer that points to a block full of pointers, effectively extending the file&rsquo;s capacity. Even larger files use double indirect and triple indirect pointers, creating a tree structure that can address massive amounts of data while keeping small files efficient.</p>
<p><strong>Practical Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Use stat to see all inode information</span>
</span></span><span class="line"><span class="cl">$ stat /etc/passwd
</span></span><span class="line"><span class="cl">  File: /etc/passwd
</span></span><span class="line"><span class="cl">  Size: <span class="m">2847</span>          Blocks: <span class="m">8</span>          IO Block: <span class="m">4096</span>   regular file
</span></span><span class="line"><span class="cl">Device: 803h/2051d    Inode: <span class="m">1234567</span>     Links: <span class="m">1</span>
</span></span><span class="line"><span class="cl">Access: <span class="o">(</span>0644/-rw-r--r--<span class="o">)</span>  Uid: <span class="o">(</span>    0/    root<span class="o">)</span>   Gid: <span class="o">(</span>    0/    root<span class="o">)</span>
</span></span><span class="line"><span class="cl">Access: 2025-10-04 10:23:15.123456789 +0530
</span></span><span class="line"><span class="cl">Modify: 2025-10-04 10:23:15.123456789 +0530
</span></span><span class="line"><span class="cl">Change: 2025-10-04 10:23:15.123456789 +0530
</span></span><span class="line"><span class="cl"> Birth: 2025-10-01 08:15:30.987654321 +0530
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># View block allocation pattern for a file</span>
</span></span><span class="line"><span class="cl">$ filefrag -v /var/log/syslog
</span></span><span class="line"><span class="cl">Filesystem <span class="nb">type</span> is: ef53
</span></span><span class="line"><span class="cl">File size of /var/log/syslog is <span class="m">1048576</span> <span class="o">(</span><span class="m">256</span> blocks of <span class="m">4096</span> bytes<span class="o">)</span>
</span></span><span class="line"><span class="cl"> ext:     logical_offset:        physical_offset: length:   expected: flags:
</span></span><span class="line"><span class="cl">   0:        0..     127:    1234568..   1234695:    128:
</span></span><span class="line"><span class="cl">   1:      128..     255:    2345678..   2345805:    128:    1234696: last,eof
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Find files by their inode number</span>
</span></span><span class="line"><span class="cl">$ find /etc -inum <span class="m">1234567</span>
</span></span><span class="line"><span class="cl">/etc/passwd
</span></span></code></pre></div><h2 id="how-inodes-work-in-practice">How Inodes Work in Practice<a hidden class="anchor" aria-hidden="true" href="#how-inodes-work-in-practice">#</a></h2>
<p>Every file and directory in a Linux filesystem has a unique inode number within that filesystem. You can see these numbers using the <code>ls -i</code> command. The root directory always gets inode number 2, and the numbering continues from there. When you create a new file, the filesystem finds a free inode from its bitmap, fills it with metadata, and creates a directory entry that maps the filename to the inode number.</p>
<p>Hard links are an interesting consequence of the inode system. When you create a hard link, you&rsquo;re simply creating another directory entry that points to the same inode. Both filenames share the exact same data and metadata because they&rsquo;re pointing to the same inode. This is why modifying one hard-linked file immediately affects all others with the same inode number. The link count in the inode keeps track of how many names point to it, and only when this reaches zero can the file truly be deleted.</p>
<p>Symbolic links work differently. A symbolic link is actually a special type of file that has its own inode. Instead of pointing to data blocks with file content, its data blocks contain the path to another file. This is why symbolic links can break if the target file is moved or deleted, while hard links cannot break as long as one link remains.</p>
<p><strong>Practical Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create a test file and examine its inode</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;Original content&#34;</span> &gt; original.txt
</span></span><span class="line"><span class="cl">$ ls -li original.txt
</span></span><span class="line"><span class="cl"><span class="m">9876543</span> -rw-r--r-- <span class="m">1</span> user user <span class="m">17</span> Oct <span class="m">04</span> 11:05 original.txt
</span></span><span class="line"><span class="cl"><span class="c1"># Note the inode number (9876543) and link count (1)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a hard link - same inode, increased link count</span>
</span></span><span class="line"><span class="cl">$ ln original.txt hardlink.txt
</span></span><span class="line"><span class="cl">$ ls -li original.txt hardlink.txt
</span></span><span class="line"><span class="cl"><span class="m">9876543</span> -rw-r--r-- <span class="m">2</span> user user <span class="m">17</span> Oct <span class="m">04</span> 11:05 hardlink.txt
</span></span><span class="line"><span class="cl"><span class="m">9876543</span> -rw-r--r-- <span class="m">2</span> user user <span class="m">17</span> Oct <span class="m">04</span> 11:05 original.txt
</span></span><span class="line"><span class="cl"><span class="c1"># Same inode number! Link count is now 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Modify through hard link - both files change</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;Modified&#34;</span> &gt;&gt; hardlink.txt
</span></span><span class="line"><span class="cl">$ cat original.txt
</span></span><span class="line"><span class="cl">Original content
</span></span><span class="line"><span class="cl">Modified
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a symbolic link - different inode</span>
</span></span><span class="line"><span class="cl">$ ln -s original.txt symlink.txt
</span></span><span class="line"><span class="cl">$ ls -li symlink.txt
</span></span><span class="line"><span class="cl"><span class="m">1111111</span> lrwxrwxrwx <span class="m">1</span> user user <span class="m">12</span> Oct <span class="m">04</span> 11:07 symlink.txt -&gt; original.txt
</span></span><span class="line"><span class="cl"><span class="c1"># Different inode number (1111111)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Delete original - hard link still works, symlink breaks</span>
</span></span><span class="line"><span class="cl">$ rm original.txt
</span></span><span class="line"><span class="cl">$ cat hardlink.txt
</span></span><span class="line"><span class="cl">Original content
</span></span><span class="line"><span class="cl">Modified
</span></span><span class="line"><span class="cl">$ cat symlink.txt
</span></span><span class="line"><span class="cl">cat: symlink.txt: No such file or directory
</span></span></code></pre></div><h2 id="filesystem-operations-and-inodes">Filesystem Operations and Inodes<a hidden class="anchor" aria-hidden="true" href="#filesystem-operations-and-inodes">#</a></h2>
<p>Understanding inodes helps explain why certain file operations behave the way they do. When you move a file within the same filesystem, Linux simply updates the directory entry to point to the existing inode in a new location. The inode number doesn&rsquo;t change, and no data is copied, making it an extremely fast operation. However, moving a file across different filesystems requires creating a new inode on the destination, copying all the data, and then deleting the original, which is much slower.</p>
<p>The <code>stat</code> command reveals all the information stored in an inode. When you run it on a file, you see the inode number, file size, number of blocks allocated, permissions, ownership, and all the timestamps. This command literally reads the inode and presents its contents in a human-readable format.</p>
<p><strong>Practical Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Create a test file</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;Test data&#34;</span> &gt; testfile.txt
</span></span><span class="line"><span class="cl">$ stat testfile.txt <span class="p">|</span> grep Inode
</span></span><span class="line"><span class="cl">Device: 803h/2051d  Inode: <span class="m">5555555</span>     Links: <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Move within same filesystem - inode doesn&#39;t change</span>
</span></span><span class="line"><span class="cl">$ mv testfile.txt /tmp/testfile.txt
</span></span><span class="line"><span class="cl">$ stat /tmp/testfile.txt <span class="p">|</span> grep Inode
</span></span><span class="line"><span class="cl">Device: 803h/2051d  Inode: <span class="m">5555555</span>     Links: <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Same inode number! Only directory entry changed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Time the operation - it&#39;s instant</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">time</span> mv /tmp/testfile.txt /tmp/renamed.txt
</span></span><span class="line"><span class="cl">real    0m0.001s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Moving across filesystems creates new inode</span>
</span></span><span class="line"><span class="cl">$ mv /tmp/renamed.txt /mnt/other_disk/
</span></span><span class="line"><span class="cl">$ stat /mnt/other_disk/renamed.txt <span class="p">|</span> grep Inode
</span></span><span class="line"><span class="cl">Device: 804h/2052d  Inode: <span class="m">7777777</span>     Links: <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Different device and inode number - data was copied</span>
</span></span></code></pre></div><h2 id="common-issues-and-considerations">Common Issues and Considerations<a hidden class="anchor" aria-hidden="true" href="#common-issues-and-considerations">#</a></h2>
<p>One of the most frustrating problems system administrators encounter is inode exhaustion. This occurs when you&rsquo;ve used up all available inodes even though disk space remains. It typically happens on systems that accumulate many small files, such as mail servers or systems with poor log rotation. The error message says &ldquo;No space left on device&rdquo; which is technically true, but it&rsquo;s the inode space that&rsquo;s exhausted, not disk space. You can check inode usage with <code>df -i</code> to see both total inodes and how many are in use.</p>
<p>Different filesystems handle inodes differently. Traditional ext filesystems allocate all inodes at creation time, which is why you need to choose the right inode ratio for your use case. XFS takes a more modern approach with dynamic inode allocation, creating them on demand as files are created. This eliminates the possibility of running out of inodes while having free disk space. Btrfs and ZFS use even more advanced structures that integrate checksums and other features directly into their inode-equivalent structures.</p>
<p><strong>Practical Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check for inode exhaustion</span>
</span></span><span class="line"><span class="cl">$ df -h /dev/sdb1
</span></span><span class="line"><span class="cl">Filesystem      Size  Used Avail Use% Mounted on
</span></span><span class="line"><span class="cl">/dev/sdb1       100G   20G   80G  20% /mnt/data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ df -i /dev/sdb1
</span></span><span class="line"><span class="cl">Filesystem      Inodes  IUsed   IFree IUse% Mounted on
</span></span><span class="line"><span class="cl">/dev/sdb1       <span class="m">524288</span> <span class="m">524288</span>       <span class="m">0</span>  100% /mnt/data
</span></span><span class="line"><span class="cl"><span class="c1"># 100% inodes used but only 20% disk space!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Find directories with most files</span>
</span></span><span class="line"><span class="cl">$ sudo find /mnt/data -xdev -type d -exec sh -c <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="s1">&#39;echo $(ls -A1 &#34;$1&#34; | wc -l) &#34;$1&#34;&#39;</span> _ <span class="o">{}</span> <span class="se">\;</span> <span class="p">|</span> sort -rn <span class="p">|</span> head -5
</span></span><span class="line"><span class="cl"><span class="m">45678</span> /mnt/data/mail/user1/.Trash
</span></span><span class="line"><span class="cl"><span class="m">34521</span> /mnt/data/cache/sessions
</span></span><span class="line"><span class="cl"><span class="m">23456</span> /mnt/data/tmp/uploads
</span></span><span class="line"><span class="cl"><span class="m">12345</span> /mnt/data/logs/old
</span></span><span class="line"><span class="cl"><span class="m">10234</span> /mnt/data/mail/user2/cur
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create filesystem with more inodes</span>
</span></span><span class="line"><span class="cl">$ sudo mkfs.ext4 -i <span class="m">4096</span> /dev/sdb1  <span class="c1"># One inode per 4KB</span>
</span></span><span class="line"><span class="cl">$ sudo mkfs.ext4 -N <span class="m">2000000</span> /dev/sdb1  <span class="c1"># Exactly 2 million inodes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check inode settings on existing filesystem</span>
</span></span><span class="line"><span class="cl">$ sudo tune2fs -l /dev/sda1 <span class="p">|</span> grep -i inode
</span></span><span class="line"><span class="cl">Inode count:              <span class="m">6553600</span>
</span></span><span class="line"><span class="cl">Free inodes:              <span class="m">6103600</span>
</span></span><span class="line"><span class="cl">Inodes per group:         <span class="m">8192</span>
</span></span><span class="line"><span class="cl">Inode size:               <span class="m">256</span>
</span></span></code></pre></div><h2 id="performance-and-caching">Performance and Caching<a hidden class="anchor" aria-hidden="true" href="#performance-and-caching">#</a></h2>
<p>Linux maintains an inode cache in RAM to speed up file operations. When you access a file, its inode is loaded into memory and kept there for quick access. This is why the second time you run <code>ls -l</code> in a directory, it&rsquo;s noticeably faster than the first time. The inode cache is part of the Virtual File System layer, which provides a unified interface across different filesystem types.</p>
<p>The size of inodes can be configured when creating a filesystem, and larger inodes offer advantages like storing extended attributes inline and supporting nanosecond precision timestamps. However, they also consume more space. The default 256-byte inode size in ext4 is a reasonable compromise for most workloads.</p>
<p><strong>Practical Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Check inode cache statistics</span>
</span></span><span class="line"><span class="cl">$ cat /proc/sys/fs/inode-nr
</span></span><span class="line"><span class="cl"><span class="m">105234</span>  <span class="m">8945</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Total allocated inodes | Free inodes in cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cat /proc/sys/fs/inode-state
</span></span><span class="line"><span class="cl"><span class="m">105234</span>  <span class="m">8945</span>  <span class="m">0</span>  <span class="m">0</span>  <span class="m">0</span>  <span class="m">0</span>  <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Clear caches to see performance difference</span>
</span></span><span class="line"><span class="cl">$ sudo sync <span class="o">&amp;&amp;</span> sudo sysctl -w vm.drop_caches<span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">time</span> ls -l /usr/bin &gt; /dev/null
</span></span><span class="line"><span class="cl">real    0m0.234s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run again with warm cache</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">time</span> ls -l /usr/bin &gt; /dev/null
</span></span><span class="line"><span class="cl">real    0m0.012s
</span></span><span class="line"><span class="cl"><span class="c1"># Much faster with cached inodes!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use debugfs to examine inode details (requires root)</span>
</span></span><span class="line"><span class="cl">$ sudo debugfs -R <span class="s2">&#34;stat &lt;1234567&gt;&#34;</span> /dev/sda1
</span></span><span class="line"><span class="cl">Inode: <span class="m">1234567</span>   Type: regular    Mode:  <span class="m">0644</span>   Flags: 0x80000
</span></span><span class="line"><span class="cl">Generation: <span class="m">3456789012</span>    Version: 0x00000000:00000001
</span></span><span class="line"><span class="cl">User:     <span class="m">0</span>   Group:     <span class="m">0</span>   Size: <span class="m">2847</span>
</span></span><span class="line"><span class="cl">File ACL: <span class="m">0</span>    Directory ACL: <span class="m">0</span>
</span></span><span class="line"><span class="cl">Links: <span class="m">1</span>   Blockcount: <span class="m">8</span>
</span></span><span class="line"><span class="cl">Fragment:  Address: <span class="m">0</span>    Number: <span class="m">0</span>    Size: <span class="m">0</span>
</span></span><span class="line"><span class="cl"> ctime: 0x6525ab3f:1e8b4d88 -- Fri Oct  <span class="m">4</span> 10:23:15 <span class="m">2025</span>
</span></span><span class="line"><span class="cl"> atime: 0x6525ab3f:1e8b4d88 -- Fri Oct  <span class="m">4</span> 10:23:15 <span class="m">2025</span>
</span></span><span class="line"><span class="cl"> mtime: 0x6525ab3f:1e8b4d88 -- Fri Oct  <span class="m">4</span> 10:23:15 <span class="m">2025</span>
</span></span><span class="line"><span class="cl">crtime: 0x6522f1d2:3c4e5a7b -- Tue Oct  <span class="m">1</span> 08:15:30 <span class="m">2025</span>
</span></span><span class="line"><span class="cl">Size of extra inode fields: <span class="m">32</span>
</span></span><span class="line"><span class="cl">EXTENTS:
</span></span><span class="line"><span class="cl"><span class="o">(</span>0<span class="o">)</span>:1234568
</span></span></code></pre></div><h2 id="advanced-techniques">Advanced Techniques<a hidden class="anchor" aria-hidden="true" href="#advanced-techniques">#</a></h2>
<p><strong>Finding All Hard Links to a File:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Get inode number</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">inode_num</span><span class="o">=</span><span class="k">$(</span>stat -c %i myfile.txt<span class="k">)</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="nv">$inode_num</span>
</span></span><span class="line"><span class="cl"><span class="m">9876543</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Find all files with same inode</span>
</span></span><span class="line"><span class="cl">$ find /home -xdev -inum <span class="nv">$inode_num</span> 2&gt;/dev/null
</span></span><span class="line"><span class="cl">/home/user/myfile.txt
</span></span><span class="line"><span class="cl">/home/user/documents/backup.txt
</span></span><span class="line"><span class="cl">/home/user/archive/old_version.txt
</span></span></code></pre></div><p><strong>Recovering Deleted Files:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># If a process still has the file open</span>
</span></span><span class="line"><span class="cl">$ lsof <span class="p">|</span> grep deleted
</span></span><span class="line"><span class="cl">apache   <span class="m">1234</span>  www-data   3w   REG  8,1  <span class="m">1048576</span>  <span class="m">9999999</span> /tmp/logfile <span class="o">(</span>deleted<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Recover via /proc filesystem</span>
</span></span><span class="line"><span class="cl">$ cp /proc/1234/fd/3 /tmp/recovered_logfile
</span></span></code></pre></div><p><strong>Working with Extended Attributes:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Set custom metadata</span>
</span></span><span class="line"><span class="cl">$ setfattr -n user.comment -v <span class="s2">&#34;Important document&#34;</span> file.txt
</span></span><span class="line"><span class="cl">$ setfattr -n user.project -v <span class="s2">&#34;Project-X&#34;</span> file.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># View extended attributes</span>
</span></span><span class="line"><span class="cl">$ getfattr -d file.txt
</span></span><span class="line"><span class="cl"><span class="c1"># file: file.txt</span>
</span></span><span class="line"><span class="cl">user.comment<span class="o">=</span><span class="s2">&#34;Important document&#34;</span>
</span></span><span class="line"><span class="cl">user.project<span class="o">=</span><span class="s2">&#34;Project-X&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Copy file preserving extended attributes</span>
</span></span><span class="line"><span class="cl">$ cp --preserve<span class="o">=</span>xattr file.txt backup.txt
</span></span></code></pre></div><h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>The inode table represents decades of refined filesystem design, providing a robust foundation for file management in Linux. By separating file metadata from filenames and data, the inode system enables features like hard links, efficient file operations, and flexible storage management. Whether you&rsquo;re troubleshooting a mysterious &ldquo;disk full&rdquo; error that isn&rsquo;t really about disk space, or optimizing a filesystem for millions of small files, understanding inodes gives you insight into how Linux truly manages your data at the lowest level.</p>
<p>This knowledge transforms you from someone who uses a filesystem to someone who understands it, making you a more effective system administrator or developer. The practical commands and examples provided throughout this guide give you the tools to explore, monitor, and troubleshoot inode-related issues in real-world scenarios.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/blog/">Blog</a></li>
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/filesystems/">Filesystems</a></li>
      <li><a href="http://localhost:1313/tags/inode/">Inode</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/d5ad17a7c7a95be35679fb94b2ab25e3/">
    <span class="title">« Prev</span>
    <br>
    <span>Docker CLI Cheat Sheet: More then you need.</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/e3e0502f6219a9c5edb5e39c4e70f043/">
    <span class="title">Next »</span>
    <br>
    <span>Docker in a Nutshell: Box It, Ship It, Forget It</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on x"
            href="https://x.com/intent/tweet/?text=Understanding%20Linux%20Filesystem%20Inode%20Tables&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f&amp;hashtags=blog%2clinux%2cfilesystems%2cinode">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f&amp;title=Understanding%20Linux%20Filesystem%20Inode%20Tables&amp;summary=Understanding%20Linux%20Filesystem%20Inode%20Tables&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f&title=Understanding%20Linux%20Filesystem%20Inode%20Tables">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on whatsapp"
            href="https://api.whatsapp.com/send?text=Understanding%20Linux%20Filesystem%20Inode%20Tables%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on telegram"
            href="https://telegram.me/share/url?text=Understanding%20Linux%20Filesystem%20Inode%20Tables&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Understanding Linux Filesystem Inode Tables on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Understanding%20Linux%20Filesystem%20Inode%20Tables&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f4%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
